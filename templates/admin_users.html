<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin ‚Äî Users</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root { --bg: #080c14; --surface: #0f1623; --border: rgba(255,255,255,0.06); --accent: #38bdf8; --accent2: #818cf8; --text: #e2e8f0; --muted: #64748b; --sidebar-w: 270px; }
        body { font-family: 'DM Sans', sans-serif; background: #f1f5f9; min-height: 100vh; }

        .sidebar { position: fixed; left: 0; top: 0; width: var(--sidebar-w); height: 100vh; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; z-index: 10; }
        .sidebar::before { content: ''; position: absolute; top: -80px; left: -60px; width: 320px; height: 320px; background: radial-gradient(circle, rgba(56,189,248,0.12) 0%, transparent 70%); pointer-events: none; }
        .brand { display: flex; align-items: center; gap: 10px; padding: 22px 24px 18px; border-bottom: 1px solid var(--border); }
        .brand-icon { width: 34px; height: 34px; border-radius: 8px; background: linear-gradient(135deg, #ef4444, #f97316); display: grid; place-items: center; font-size: 16px; flex-shrink: 0; }
        .brand-name { font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 800; color: var(--text); }
        .brand-name span { color: #ef4444; }
        .admin-badge { margin: 12px 16px; background: linear-gradient(135deg, #ef4444, #f97316); border-radius: 10px; padding: 10px 14px; display: flex; align-items: center; gap: 8px; }
        .admin-badge span { font-size: 12px; font-weight: 700; color: white; letter-spacing: 0.08em; text-transform: uppercase; }
        nav { flex: 1; padding: 6px 12px; overflow-y: auto; }
        nav::-webkit-scrollbar { width: 0; }
        .nav-label { font-size: 10px; font-weight: 600; letter-spacing: 0.1em; color: var(--muted); padding: 14px 10px 6px; text-transform: uppercase; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-radius: 10px; color: #94a3b8; text-decoration: none; font-size: 14px; font-weight: 500; transition: background 0.2s, color 0.2s; position: relative; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .nav-item.active { background: rgba(239,68,68,0.12); color: #ef4444; }
        .nav-item.active::before { content: ''; position: absolute; left: 0; top: 20%; height: 60%; width: 3px; border-radius: 2px; background: #ef4444; }
        .nav-icon { font-size: 16px; width: 20px; text-align: center; }
        .logout { margin: 0 12px 16px; display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-radius: 10px; color: #f87171; font-size: 14px; font-weight: 500; text-decoration: none; transition: background 0.2s; }
        .logout:hover { background: rgba(248,113,113,0.1); }

        .main { margin-left: var(--sidebar-w); padding: 36px; }
        .page-header { margin-bottom: 28px; }
        .page-header h1 { font-family: 'Syne', sans-serif; font-size: 24px; color: #0f172a; }
        .page-header p { color: #64748b; font-size: 13px; margin-top: 4px; }

        .flash { padding: 14px 18px; border-radius: 12px; margin-bottom: 20px; font-size: 14px; font-weight: 500; }
        .flash.success { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }

        /* Search */
        .search-bar { display: flex; gap: 12px; margin-bottom: 22px; }
        .search-bar input { flex: 1; max-width: 360px; padding: 11px 16px; border: 1.5px solid #e5e7eb; border-radius: 10px; font-family: 'DM Sans', sans-serif; font-size: 14px; outline: none; background: white; transition: border-color 0.2s; }
        .search-bar input:focus { border-color: #38bdf8; }

        .section { background: white; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.06); overflow: hidden; }
        .section-head { padding: 18px 22px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; justify-content: space-between; }
        .section-head h2 { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700; color: #0f172a; }
        .section-head span { font-size: 12px; color: #94a3b8; }

        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: #94a3b8; background: #f8fafc; border-bottom: 1px solid #f1f5f9; white-space: nowrap; }
        td { padding: 14px 16px; font-size: 13px; color: #374151; border-bottom: 1px solid #f8fafc; vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #fafafa; }

        .user-cell { display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; border: 2px solid #e2e8f0; flex-shrink: 0; }
        .user-name { font-weight: 600; color: #0f172a; }
        .user-email { font-size: 11px; color: #94a3b8; }

        .role-badge { font-size: 11px; font-weight: 700; padding: 4px 12px; border-radius: 20px; }
        .role-student  { background: #e0f2fe; color: #0369a1; }
        .role-faculty  { background: #ede9fe; color: #7c3aed; }
        .role-admin    { background: #fee2e2; color: #dc2626; }
        .role-other    { background: #f1f5f9; color: #475569; }

        .btn-view { font-size: 12px; color: #0ea5e9; font-weight: 600; text-decoration: none; background: #e0f2fe; padding: 5px 12px; border-radius: 8px; transition: background 0.2s; white-space: nowrap; }
        .btn-view:hover { background: #bae6fd; }

        @media (max-width: 900px) { .sidebar { display: none; } .main { margin-left: 0; padding: 20px 16px; } }
    </style>
</head>
<body>
<div class="sidebar">
    <div class="brand"><div class="brand-icon">üõ°Ô∏è</div><div class="brand-name">Admin<span> Panel</span></div></div>
    <div class="admin-badge"><span>üîê</span><span>{{ admin.name }}</span></div>
    <nav>
        <div class="nav-label">Admin</div>
        <a href="{{ url_for('admin_dashboard', admin_id=admin.id) }}" class="nav-item"><span class="nav-icon">üìä</span> Dashboard</a>
        <a href="{{ url_for('admin_users', admin_id=admin.id) }}" class="nav-item active"><span class="nav-icon">üë•</span> All Users</a>
        <div class="nav-label">Browse</div>
        <a href="{{ url_for('lost_items_list', user_id=admin.id) }}" class="nav-item"><span class="nav-icon">üîé</span> Lost Items</a>
        <a href="{{ url_for('found_items_list', user_id=admin.id) }}" class="nav-item"><span class="nav-icon">üìã</span> Found Items</a>
    </nav>
    <a href="/logout" class="logout"><span class="nav-icon">üö™</span> Logout</a>
</div>

<div class="main">
    <div class="page-header">
        <h1>üë• All Users</h1>
        <p>{{ users | length }} registered accounts on the platform.</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
    {% endwith %}

    <div class="search-bar">
        <input type="text" id="userSearch" placeholder="üîç Search by name, email or department‚Ä¶" oninput="filterUsers()">
    </div>

    <div class="section">
        <div class="section-head">
            <h2>Registered Users</h2>
            <span id="userCount">{{ users | length }} users</span>
        </div>
        <div class="table-wrap">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>User</th>
                        <th>Department</th>
                        <th>Year</th>
                        <th>Section</th>
                        <th>Mobile</th>
                        <th>Role</th>
                        <th>Joined</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr class="user-row" data-search="{{ u.name | lower }} {{ u.email | lower }} {{ u.department | lower }}">
                        <td style="color:#94a3b8;">{{ u.id }}</td>
                        <td>
                            <div class="user-cell">
                                <img class="user-avatar" src="{{ url_for('static', filename='uploads/' + u.profile_pic) }}" alt="{{ u.name }}">
                                <div>
                                    <div class="user-name">{{ u.name }}</div>
                                    <div class="user-email">{{ u.email }}</div>
                                </div>
                            </div>
                        </td>
                        <td>{{ u.department }}</td>
                        <td>{{ u.year or '‚Äî' }}</td>
                        <td>{{ u.section or '‚Äî' }}</td>
                        <td>{{ u.mobile }}</td>
                        <td>
                            <span class="role-badge {% if u.role == 'Admin' %}role-admin{% elif u.role == 'Student' %}role-student{% elif u.role == 'Faculty' %}role-faculty{% else %}role-other{% endif %}">{{ u.role }}</span>
                        </td>
                        <td style="white-space:nowrap; color:#94a3b8;">{{ u.created_at.strftime('%d %b %Y') }}</td>
                        <td>
                            <a href="{{ url_for('profile', user_id=u.id) }}" class="btn-view">View Profile</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function filterUsers() {
    const q = document.getElementById('userSearch').value.toLowerCase();
    const rows = document.querySelectorAll('.user-row');
    let visible = 0;
    rows.forEach(row => {
        const match = row.dataset.search.includes(q);
        row.style.display = match ? '' : 'none';
        if (match) visible++;
    });
    document.getElementById('userCount').textContent = visible + ' users';
}
</script>
<div style="text-align:center; padding:15px; background:#1a1a2e; color:#fff; font-size:14px; margin-top:20px;">
Developed by <b>Patan Jamsheer</b> | CSE (AI-ML)
</div>
<div style="text-align:center; padding:15px; background:#1a1a2e; color:#fff; font-size:14px; margin-top:20px;">
Developed by <b>Patan Jamsheer</b> | CSE (AI-ML)
</div>
<div style="text-align:center; padding:15px; background:#1a1a2e; color:#fff; font-size:14px; margin-top:20px;">Developed by <b>Patan Jamsheer</b> | CSE (AI-ML)</div>
</body>
</html>